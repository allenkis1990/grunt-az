<!DOCTYPE html>
<html ng-app="myapp">
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>
        body{padding:50px 0px 0px 100px;}
        *{list-style:none; margin:0; padding:0;}
        textarea{width:300px; height:70px; resize:none;}
        input[type="checkbox"]{vertical-align:32px;}
        .ml-1{margin-left:10px;}
        .mt-1{margin-top:10px;}
        .mb-1{margin-bottom:10px;}
    </style>
</head>
<body ng-controller="myctrl">
<button ng-click="isCheckboxShow=!isCheckboxShow" class="mb-1">批量管理</button>
<!--<ul>
    <li>
        <ul>
            <li ng-repeat="item in data" editdiv>
                <input ng-checked="item.isChecked" ng-click="checkIt($index)" type="checkbox" ng-show="isCheckboxShow" />
                <textarea readonly>{{item.info}}</textarea>
                <a href="javascript:void(0)" class="edit">编辑</a>
                <a href="javascript:void(0)" ng-click="delete($index)">删除</a>
            </li>

        </ul>
    </li>
</ul>-->

<ul manydelete>
    <li ng-repeat="item in data" class="item-zj">
        <div><h2>第<span>{{item.zj}}</span>章</h2></div>
        <ul class="ks-ul">
            <li class="parentitem" ng-repeat="itemerzi in item.zjitem" >
                <div class="mt-1">第{{itemerzi.ks}}课时</div>
                <ul class="mt-1 item-list">
                    <li ischeck="{{itemsunzi.ischecked}}" class="mt-1" ng-repeat="itemsunzi in itemerzi.info" editdiv>
                        <input ng-checked="itemsunzi.ischecked" ng-click="checkIt(itemerzi.info,$index)" type="checkbox" ng-show="isCheckboxShow" />
                        <textarea readonly>{{itemsunzi.info}}</textarea>
                        <a href="javascript:void(0)" class="edit">编辑</a>
                        <a href="javascript:void(0)" ng-click="delete(itemerzi.info,$index)">删除</a>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
</ul>
<button ng-click="manyDelete()" class="mt-1 many-del">批量删除！</button>
<script type="text/javascript" src="../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../js/angular.min.js"></script>
<script>
   var app= angular.module("myapp",[]);
    app.controller("myctrl",function($scope){
$scope.data=[
    {zj:1,zjitem:
        [
            {ks:1.1,info:[{id:"item1-1-1",ischecked:false,time:"xxx",info:"第1章第1课时第1笔记"},{id:"item1-1-2",ischecked:false,time:"xxx",info:"第1章第1第2笔记"}]},
            {ks:1.2,info:[{id:"item1-2-1",ischecked:false,time:"xxx",info:"第1章第2课时第1笔记"},{id:"item1-2-2",ischecked:false,time:"xxx",info:"第1章第2课时第2笔记"}]},
            {ks:1.3,info:[{id:"item1-3-1",ischecked:false,time:"xxx",info:"第1章第3课时第1笔记"},{id:"item1-3-2",ischecked:false,time:"xxx",info:"第1章第3课时第2笔记"}]}
        ]
    },

    {zj:2,zjitem:
            [
                {ks:2.1,info:[{id:"item2-1-1",ischecked:false,time:"xxx",info:"第2章第1课时第1笔记"},{id:"item2-1-2",ischecked:false,time:"xxx",info:"第2章第1第2笔记"}]},
                {ks:2.2,info:[{id:"item2-2-1",ischecked:false,time:"xxx",info:"第2章第2课时第1笔记"},{id:"item2-2-2",ischecked:false,time:"xxx",info:"第2章第2课时第2笔记"}]},
                {ks:2.3,info:[{id:"item2-3-1",ischecked:false,time:"xxx",info:"第2章第3课时第1笔记"},{id:"item2-3-2",ischecked:false,time:"xxx",info:"第2章第3课时第2笔记"}]}
            ]
    },

    {zj:3,zjitem:
            [
                {ks:3.1,info:[{id:"item3-1-1",ischecked:false,time:"xxx",info:"第3章第1课时第1笔记"},{id:"item3-1-2",ischecked:false,time:"xxx",info:"第3章第1第2笔记"}]},
                {ks:3.2,info:[{id:"item3-2-1",ischecked:false,time:"xxx",info:"第3章第2课时第1笔记"},{id:"item3-2-2",ischecked:false,time:"xxx",info:"第3章第2课时第2笔记"}]},
                {ks:3.3,info:[{id:"item3-3-1",ischecked:false,time:"xxx",info:"第3章第3课时第1笔记"},{id:"item3-3-2",ischecked:false,time:"xxx",info:"第3章第3课时第2笔记"}]}
            ]
    }
];


        $scope.delete=function(arr, index){//arr是直接把外面的数组传进来  单个删除
                arr.splice(index, 1);
        }

        $scope.isCheckboxShow=false;//checkbox是否显示


        $scope.checkIt=function(arr,index){ //点击checkbox切换true和false
            arr[index].ischecked=!arr[index].ischecked;
            if(arr[index].ischecked==true){
                $scope.deleteArr=arr.concat();
                $scope.deleteArr.splice(index,1)
            }
            //console.log($scope.data[index].isChecked);
            //console.log($scope.data);
        }



        $scope.manyDelete=function(){ //批量删除选中的

            console.log($scope.deleteArr);

        }
    });


    app.directive("editdiv",function(){ //toggle编辑状态  可编辑/不可编辑
        return {
            restrict:"A",
            link:function(scope,ele,attr){
                var edit=$(ele);
                var mark=true;
                edit.find(".edit").click(function(){
                    var par=$(this).parent();
                    //var index=par.index();
                    var isTrue=par.find("textarea").attr("readonly");
                    if(mark){
                        $(this).html("取消编辑");
                        if(isTrue){
                            par.find("textarea").removeAttr("readonly").focus();
                            //alert(1);
                        }
                        mark=false;
                    }else{
                        $(this).html("编辑");
                        if(!isTrue){
                            par.find("textarea").attr("readonly","readonly").blur();
                        }

                        mark=true;
                    }

                });
            }
        }
    });


   /*app.directive("manydelete",function(){ //toggle编辑状态  可编辑/不可编辑
       return {
           restrict:"A",
           link:function(scope,ele,attr){
               $(".many-del").click(function(){
                   var deleteLi=$(ele).find(".item-list").find("li");
                   var deleteErziUl=$(ele).find(".item-list");
                   var deleteZj=$(ele).find(".ks-ul");
                   deleteLi.each(function(){
                       if($(this).attr("ischeck")=='true'){
                           $(this).remove();
                       }
                   });
                   deleteErziUl.each(function(){ //length为0时连带课时也删除
                       if($(this).children().length==0){
                           $(this).parents(".parentitem").remove();
                       }
                   });

                   deleteZj.each(function(){//length为0时连带章节也删除
                       if($(this).children().length==0){
                           $(this).parents(".item-zj").remove();
                       }
                   });


               });
           }
       }
   });*/

</script>
</body>
</html>
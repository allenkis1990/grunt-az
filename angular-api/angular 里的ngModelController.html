<!DOCTYPE html>
<html ng-app="myapp">
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body ng-controller="myctrl">

<form name="myForm">
    <input name="text" ng-model="text" mydir par />
</form>
<div>{{myForm.text.$error.par}}</div>

<script type="text/javascript" src="../js/angular.min2.js"></script>
<script>
    var app= angular.module("myapp",[]);
    app.controller("myctrl",function($scope){
        $scope.text=222;
    });

    //$validators同步验证
    app.directive('mydir',function(){
        return {
            require:'ngModel',
            link:function($scope,ele,attr,ngModel){
                //console.log(ngModel.$validators);
                ngModel.$validators.par=function(modelVal,viewsVal){
                    var val=modelVal || viewsVal;
                    if(val==666){
                       return true
                    }else{
                        return false;
                    }
                }
            }
        }
    });

    //$asyncValidators 异步验证
   /* app.directive('validateName',function($http,$q){
        return {
            restrict:'A',
            require:'?^ngModel',
            link:function(scope,iele,iattr,ctrl){
                ctrl.$asyncValidators.uniqueUsername = function(modelValue, viewValue) {
                    var value = modelValue || viewValue;
                    // 异步验证用户名是否已经存在
                    return $http.get('/api/users/' + value).
                            then(function resolved(res) {
                                if(res.data){
                                    //用户名已经存在,验证失败,给下一个promise传递失败通知.
                                    return $q.reject('res.data');
                                }
                                else {
                                    //用户名不存在,验证成功.
                                    return true
                                }

                            }, function rejected() {
                                //请求失败
                            })
                };
            }
        }
    });*/
</script>
</body>
</html>
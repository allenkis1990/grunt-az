/**

 ◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇
 ◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◆◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◇◇◇◇◇
 ◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◇◇◇◇◇◇
 ◇◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◆◆◆◇◆◇◇◇◆◆◇◇◇
 ◇◇◇◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◆◆◇◇
 ◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◆◆◆◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◆◆◇◆◆◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇
 ◇◇◆◆◆◆◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◆◆◆◆◇◆◆◇◇◇◇◇
 ◇◇◆◆◆◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◆◆◇◆◆◇◆◆◆◆◆◆◇
 ◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◆◇◇◇◇◇◇◇◇◆◇◆◆◇◆◆◇◆◆◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◇◆◆◆◆◇
 ◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◆◆◇◆◆◆◇◇◇◇◇◇◇◇◇◆◆◇◆◆◆◆◆◇◇◇◇◇◇◇◆◆◇◆◆◆◆◆◆◆◇◆◇◇◇◇
 ◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◆◆◆◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◆◆◆◆◇◇◇◇
 ◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◆◆◆◆◇◇◇◇
 ◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◆◆◇◇◇◇◇◇◇◇◇◆◆◇◇◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◇◇◇◇◆◇◇◇◇◇
 ◇◇◇◇◇◆◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◆◆◆◇◇◇◇◆◆◇◇◇◇◇◇◇◇◆◇◇◇◇◇◆◆◆◇◇◇◇◇◇◇◇◇◇◆◆◆◇◇◆◆◆◆◇◇◇◇◇
 ◇◇◇◇◇◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◆◆◆◆◇◇◇◇◇◇◆◆◆◆◇◇◇◇◆◆◇◇◇◇◇◇◆◆◆◆◆◆◇◇◇◇◇◆◆◆◇◇◇◇◆◆◆◇◇◇◇◇
 ◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◆◆◆◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◆◆◆◇◇◇◇◇◆◆◇◇◇◇◇◇◇◆◇◇◇◇◇◇
 ◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇

 */

define(function (require, exports, module) {
    'use strict';

    require('angular');
    require('angular-ui-router');
    require('angular-ocLazyLoad');
    require('angular-animate');
    var sidebarDirective = require('../directives/side-bar');
    var g = {}, process = {}, event = {};
    var sidebarDirective = require('../directives/side-bar');
    g.node = {
        sidebarId: $('#sidebar_id'),
        nullDialog: $('#null_dialog'),
        cancel: $('#cancel')
    };
    process = {
        load: function () {
            event.listener();
        }
    };

    event = {
        listener: function () {
            g.node.sidebarId.bind('click', function (e) {
                var $this = $(e.target);
                var action = $this.attr('data-action');
                if (action === 'unDeveloped') {
                    g.node.nullDialog.removeClass('hide');
                }
            });
            g.node.cancel.bind('click', function (e) {
                var $this = $(e.target);
                var action = $this.attr('action');
                g.node.nullDialog.addClass('hide');
            });
        }
    };
    process.load();
    $.get('/web/mall/mallIndex/0/getUserReturnUrl', function (data) {
        document.getElementById("return").href = data.url;
    }, "json");
    var businessIndex = angular.module('businessIndex', [
            'ui.router',
            'oc.lazyLoad',
            'ngAnimate'
        ])

        .run(
            ['$rootScope', '$state', '$stateParams',
                function ($rootScope, $state, $stateParams) {
                    $rootScope.$state = $state;
                    $rootScope.$stateParams = $stateParams;
                }
            ]
        )

        .directive('sideBar', sidebarDirective)

        //////////////////////////
        //     路由基本配置     //
        //////////////////////////
        .config(['$stateProvider', '$urlRouterProvider', '$ocLazyLoadProvider', '$locationProvider', '$httpProvider',
            function ($stateProvider, $urlRouterProvider, $ocLazyLoadProvider, $locationProvider, $httpProvider) {
                $urlRouterProvider.otherwise("index");
//                $locationProvider.hashPrefix('!');
                var namespace = 'business.',
                    ctrlSuffix = '.ctrl',
                    viewPrefix = '/public/views/business/',
                    jsPrefix = 'app/business/',
                    subModules = [];
                //////////////////////////////////
                //       注册加载js的方式        //
                //  为lazyLoad提供加载js的方式   //
                //////////////////////////////////
                $ocLazyLoadProvider.config({
                    jsLoader: seajs.use
                });

                ///////////////////////////////
                //  将模块设置到模块数组当中  //
                ///////////////////////////////
                subModules.push({modName: 'mytrainclass', directory: 'mytrainclass/', fileName: 'index.html'});
                subModules.push({modName: 'mylesson', directory: 'mylesson/', fileName: 'index.html'});
                subModules.push({modName: 'courseonline', directory: 'courseonline/', fileName: 'index.html'});
                subModules.push({modName: 'mysetting', directory: 'mysetting/', fileName: 'index.html'});  //个人设置

//

                $stateProvider.state("index", {
                    url: "/index",
                    views: {
                        "businessIndexView": {
                            controller: 'business.index.ctrl',
                            templateUrl: '/public/views/business/index/index.html'
                        }
                    },
                    resolve: {
                        loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                            return $ocLazyLoad.load({
                                name: 'business.index',
                                files: [
                                    'app/business/index/main'
                                ]
                            });
                        }]
                    }
                })
                    .state('settingpassword', {
                        url: "/settingpassword",
                        views: {
                            "businessIndexView": {
                                controller: 'business.mysetting.settingpassword.ctrl',
                                templateUrl: '/public/views/business/mysetting/setting-password.html'
                            }
                        },

                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'business.mysetting.settingpassword',
                                    files: [
                                        'app/business/mysetting/setting-password-main'
                                    ]
                                });
                            }]
                        }
                    })

                    .state('trainclassdetail', {
                        url: "/trainclassdetail/:classId",
                        views: {
                            "businessIndexView": {
                                controller: 'business.mytrainclass.train-class-detail.ctrl',
                                templateUrl: '/public/views/business/mytrainclass/train-class-detail.html'
                            }
                        },

                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'business.mytrainclass.trainclassdetail',
                                    files: [
                                        'app/business/mytrainclass/train-class-detail-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('lessondetails', {
                        url: "/lessondetails/:id/:lessonId",
                        views: {
                            "businessIndexView": {
                                controller: 'business.lessondetails.ctrl',
                                templateUrl: '/public/views/business/mytrainclass/lesson-detatils.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'business.lessondetails',
                                    files: [
                                        'app/business/mytrainclass/lesson-details-main'
                                    ]
                                });
                            }]
                        }
                    })

                    //////////////////////////////////////////////////////////////////////////
                    //  个人中心， 父节点要设置abstract这样子路由才能够有相应的效果           //
                    /////////////////////////////////////////////////////////////////////////
                    .state('personcenter', {
                        url: "/personcenter",
                        abstract: true,
                        views: {
                            "businessIndexView": {
                                templateUrl: '/public/views/business/personcenter/index.html'
                            }
                        }
                    })


                    .state("personcenter.registrationRecord", {
                        url: "/registrationRecord",
                        views: {
                            "personCenterView": {
                                controller: 'business.personcenter.record.ctrl',
                                templateUrl: '/public/views/business/personcenter/registration-cord.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'business.personcenter.record',
                                    files: [
                                        'app/business/personcenter/registration-record-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state("personcenter.code", {
                        url: "/code",
                        views: {
                            "personCenterView": {
                                controller: 'business.personcenter.code.ctrl',
                                templateUrl: '/public/views/business/personcenter/code.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'business.personcenter.code',
                                    files: [
                                        'app/business/personcenter/code-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state("personcenter.mycollect", {
                        url: "/mycollect",
                        views: {
                            "personCenterView": {
                                controller: 'business.personcenter.mycollect.ctrl',
                                templateUrl: '/public/views/business/personcenter/mycollect.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'business.personcenter.mycollect',
                                    files: [
                                        'app/business/personcenter/collect-main'
                                    ]
                                });
                            }]
                        }
                    })

                ///////////////////////////////
                //  集中配置路由指向          //
                ///////////////////////////////
                angular.forEach(subModules, function (mod, modIndex) {

                    var controllerName = namespace + mod.modName + ctrlSuffix,
                        viewHtml = viewPrefix + mod.directory + mod.fileName,
                        selfModuleName = namespace + mod.modName,
                        jsName = jsPrefix + mod.directory + (mod.jsName ? mod.jsName : 'main')

//                    console.log({ ctrl: controllerName, viewHtml: viewHtml, selfModuleName: selfModuleName, jsName: jsName }, mod.modName);

                    $stateProvider
                        .state(mod.modName, {
                            url: "/" + mod.modName,
                            views: {
                                "businessIndexView": {
                                    controller: controllerName, /// 控制器名称
                                    templateUrl: viewHtml  /// 默认加载模板
                                }
                            },
                            resolve: {
                                loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                    return $ocLazyLoad.load({
                                        name: selfModuleName,    ///　自模块名称
                                        files: [
                                            jsName /// 加载js的文件数组 ，， 可定义加载css
                                        ]
                                    });
                                }]
                            }
                        })
                });

                $locationProvider.html5Mode(false);
                //post提交乱码
                $httpProvider.defaults.transformRequest = function (data) {
                    if (data === undefined) {
                        return data;
                    }
                    return $.param(data);
                };
                $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
            }
        ]);

//    require('../directives/upload-file').registerUploadWidget(businessIndex);
});


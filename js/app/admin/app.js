/**

 ◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇
 ◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◆◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◇◇◇◇◇
 ◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◇◇◇◇◇◇
 ◇◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◆◆◆◇◆◇◇◇◆◆◇◇◇
 ◇◇◇◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◆◆◇◇
 ◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◆◆◆◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◆◆◇◆◆◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇
 ◇◇◆◆◆◆◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◆◆◆◆◇◆◆◇◇◇◇◇
 ◇◇◆◆◆◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◆◆◇◆◆◇◆◆◆◆◆◆◇
 ◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◆◇◇◇◇◇◇◇◇◆◇◆◆◇◆◆◇◆◆◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◆◇◆◆◆◆◇
 ◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◆◆◇◆◆◆◇◇◇◇◇◇◇◇◇◆◆◇◆◆◆◆◆◇◇◇◇◇◇◇◆◆◇◆◆◆◆◆◆◆◇◆◇◇◇◇
 ◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◆◆◆◇◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◆◆◆◆◇◇◇◇
 ◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◆◆◆◆◇◇◇◇
 ◇◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◆◆◇◇◇◇◇◇◇◇◇◆◆◇◇◆◆◆◆◇◇◇◇◇◇◇◇◇◇◇◇◆◆◆◇◇◇◇◆◇◇◇◇◇
 ◇◇◇◇◇◆◆◆◆◆◆◆◆◆◆◇◇◇◇◇◇◇◆◆◆◇◇◇◇◆◆◇◇◇◇◇◇◇◇◆◇◇◇◇◇◆◆◆◇◇◇◇◇◇◇◇◇◇◆◆◆◇◇◆◆◆◆◇◇◇◇◇
 ◇◇◇◇◇◆◆◆◆◆◆◇◇◇◇◇◇◇◇◇◆◆◆◆◇◇◇◇◇◇◆◆◆◆◇◇◇◇◆◆◇◇◇◇◇◇◆◆◆◆◆◆◇◇◇◇◇◆◆◆◇◇◇◇◆◆◆◇◇◇◇◇
 ◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◆◆◇◇◇◇◇◇◇◇◆◆◆◇◇◇◇◇◆◇◇◇◇◇◇◇◇◇◆◆◆◇◇◇◇◇◆◆◇◇◇◇◇◇◇◆◇◇◇◇◇◇
 ◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇

 */

define(function (require, exports, module) {
    'use strict';

    require('angular');
    require('angular-ui-router');
    require('angular-ocLazyLoad');
    require('angular-animate');
    require('jquery');
    var g = {}, process = {}, event = {};
    var sidebarDirective = require('../directives/side-bar');
    g.node = {
        sidebarId: $('#sidebar_id'),
        nullDialog: $('#null_dialog'),
        cancel: $('#cancel')
    };
    process = {
        load: function () {
            event.listener();
        }
    };

    event = {
        listener: function () {
            g.node.sidebarId.bind('click', function (e) {
                var $this = $(e.target);
                var action = $this.attr('data-action');
                if (action === 'unDeveloped') {
                    g.node.nullDialog.removeClass('hide');
                }
            });
            g.node.cancel.bind('click', function (e) {
                var $this = $(e.target);
                var action = $this.attr('action');
                g.node.nullDialog.addClass('hide');
            });
        }
    };
    process.load();
    var sidebarDirective = require('../directives/side-bar');
    $.get('/web/mall/mallIndex/0/getUserReturnUrl', function (data) {
        document.getElementById("return").href = data.url;
    }, "json");
    var adminIndex = angular.module('adminIndex', [
            'ui.router',
            'oc.lazyLoad',
            'ngAnimate'
        ])

        .run(
            ['$rootScope', '$state', '$stateParams',
                function ($rootScope, $state, $stateParams) {
                    $rootScope.$state = $state;
                    $rootScope.$stateParams = $stateParams;
                }
            ]
        )

        .directive('sideBar', sidebarDirective)

        //////////////////////////
        //     路由基本配置     //
        //////////////////////////
        .config(['$stateProvider', '$urlRouterProvider', '$ocLazyLoadProvider', '$locationProvider', '$httpProvider',
            function ($stateProvider, $urlRouterProvider, $ocLazyLoadProvider, $locationProvider, $httpProvider) {
                $urlRouterProvider.otherwise("index");
//                $locationProvider.hashPrefix('!');
                var namespace = 'admin.',
                    ctrlSuffix = '.ctrl',
                    viewPrefix = '/public/views/admin/',
                    jsPrefix = 'app/admin/',
                    subModules = [];
                //////////////////////////////////
                //       注册加载js的方式        //
                //  为lazyLoad提供加载js的方式   //
                //////////////////////////////////
                $ocLazyLoadProvider.config({
                    jsLoader: seajs.use
                });

                ///////////////////////////////
                //  将模块设置到模块数组当中  //
                ///////////////////////////////
                subModules.push({modName: 'exam', directory: 'exam/', fileName: 'index.html'});               ///考试管理
                subModules.push({modName: 'exampaper', directory: 'exampaper/', fileName: 'index.html'});               ///试卷管理
//                subModules.push({modName: 'index',          directory: 'index/',             fileName: 'index.html'});               ///管理员首页
                subModules.push({modName: 'lessonresource', directory: 'lessonresource/', fileName: 'index.html'});               ///课程资源管理
                subModules.push({modName: 'mallinfo', directory: 'mallinfo/', fileName: 'index.html'});               ///商城信息管理
                subModules.push({modName: 'message', directory: 'message/', fileName: 'index.html'});               ///信息管理
                subModules.push({modName: 'personcenter', directory: 'personcenter/', fileName: 'index.html'});               ///个人中心
                subModules.push({modName: 'registration', directory: 'registration/', fileName: 'index.html'});               ///报名记录管理
                subModules.push({modName: 'student', directory: 'student/', fileName: 'index.html'});               ///学员查询
                subModules.push({modName: 'setting', directory: 'setting/', fileName: 'index.html'});               ///设置
                subModules.push({modName: 'testing', directory: 'testing/', fileName: 'index.html'});               ///测评管理
                subModules.push({modName: 'trainclass', directory: 'trainclass/', fileName: 'index.html'});               ///培训班管理
                subModules.push({modName: 'commodity', directory: 'commodity/', fileName: 'index.html'});///商品管理
                subModules.push({modName: 'redemptioncode', directory: 'redemptioncode/', fileName: 'index.html'});///激活码管理

                $stateProvider.state("index", {
                    url: "/index",
                    views: {
                        "adminIndexView": {
                            controller: 'admin.index.ctrl',
                            templateUrl: '/public/views/admin/index/index.html'
                        }
                    },
                    resolve: {
                        loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                            return $ocLazyLoad.load({
                                name: 'admin.index',
                                files: [
                                    'app/admin/index/main'
                                ]
                            });
                        }]
                    }
                })

                    .state('releasecommodity', {
                        url: "/releasecommodity/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.releasecommodity.ctrl',
                                templateUrl: '/public/views/admin/commodity/release-commodity.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.releasecommodity',
                                    files: [
                                        'app/admin/commodity/release-commodity-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('trainclassAdd', {
                        url: "/trainclassAdd",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.trainclass.add.ctrl',
                                templateUrl: '/public/views/admin/trainclass/train-class-create.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.trainclass.add',
                                    files: [
                                        'app/admin/trainclass/add-main'
                                    ]
                                });
                            }]
                        }
                    })

                    .state('trainclassEdit', {
                        url: "/trainclassEdit/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.trainclass.edit.ctrl',
                                templateUrl: '/public/views/admin/trainclass/train-class-edit.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.trainclass.edit',
                                    files: [
                                        'app/admin/trainclass/edit-main'
                                    ]
                                });
                            }]
                        }
                    })

                    .state('trainclassDetail', {
                        url: "/trainclassDetail/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.trainclass.detail.ctrl',
                                templateUrl: '/public/views/admin/trainclass/train-class-detail.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.trainclass.detail',
                                    files: [
                                        'app/admin/trainclass/detail-main'
                                    ]
                                });
                            }]
                        }
                    })

                    .state('trainclassManage', {
                        url: "/trainclassManage/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.trainclass.manage.ctrl',
                                templateUrl: '/public/views/admin/trainclass/train-class-manage.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.trainclass.manage',
                                    files: [
                                        'app/admin/trainclass/manage-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('sendCode', {
                        url: "/sendCode/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.trainclass.sendCode.ctrl',
                                templateUrl: '/public/views/admin/trainclass/train-class-sendCode.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.trainclass.sendCode',
                                    files: [
                                        'app/admin/trainclass/sendCode-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('trainClassLessonAdd', {
                        url: "/trainClassLessonAdd/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.trainclass.lessonAdd.ctrl',
                                templateUrl: '/public/views/admin/trainclass/train-class-lessonAdd.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.trainclass.lessonAdd',
                                    files: [
                                        'app/admin/trainclass/add-lesson-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('trainClassLearnData', {
                        url: "/trainClassLearnData/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.trainclass.learnData.ctrl',
                                templateUrl: '/public/views/admin/trainclass/train-class-LearnData.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.trainclass.learnData',
                                    files: [
                                        'app/admin/trainclass/learn-data-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('orderDetails', {
                        url: "/orderDetails/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.registration.orderdetails.ctrl',
                                templateUrl: '/public/views/admin/registration/order-details.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.registration.orderdetails',
                                    files: [
                                        'app/admin/registration/order-details-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('commodityModify', {
                        url: "commodityModify/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.commodity.modify.ctrl',
                                templateUrl: '/public/views/admin/commodity/modify-commodity.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.commodity.modify',
                                    files: [
                                        'app/admin/commodity/modify-commodity-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('lessonresourceAdd', {
                        url: "/lessonresourceAdd/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.lessonresource.add.ctrl',
                                templateUrl: '/public/views/admin/lessonresource/add.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.lessonresource.add',
                                    files: [
                                        'app/admin/lessonresource/add-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('lessonresourceModify', {
                        url: "/lessonresourceModify/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.lessonresource.modify.ctrl',
                                templateUrl: '/public/views/admin/lessonresource/modify.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.lessonresource.modify',
                                    files: [
                                        'app/admin/lessonresource/modify-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('resourcetype', {
                        url: "/resourcetype",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.lessonresource.resourcetype.ctrl',
                                templateUrl: '/public/views/admin/lessonresource/resource_type.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.lessonresource.resourcetype',
                                    files: [
                                        'app/admin/lessonresource/resource-type-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('trainclasslessondetails', {
                        url: "/trainclasslessondetails/:trainClassId/:userId",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.trainclasslessondetails.ctrl',
                                templateUrl: '/public/views/admin/trainclass/train-class-lesson-details.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.trainclasslessondetails',
                                    files: [
                                        'app/admin/trainclass/train-class-lesson-details-main'
                                    ]
                                });
                            }]
                        }
                    })
                    .state('lesson', {
                        url: "/lesson/:id",
                        views: {
                            "adminIndexView": {
                                controller: 'admin.lesson.ctrl',
                                templateUrl: '/public/views/admin/trainclass/lesson-detatils.html'
                            }
                        },
                        resolve: {
                            loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load({
                                    name: 'admin.lesson',
                                    files: [
                                        'app/admin/trainclass/lesson-details-main'
                                    ]
                                });
                            }]
                        }
                    })

                ///////////////////////////////
                //  集中配置路由指向          //
                ///////////////////////////////
                angular.forEach(subModules, function (mod, modIndex) {

                    var controllerName = namespace + mod.modName + ctrlSuffix,
                        viewHtml = viewPrefix + mod.directory + mod.fileName,
                        selfModuleName = namespace + mod.modName,
                        jsName = jsPrefix + mod.directory + (mod.jsName ? mod.jsName : 'main')

//                    console.log({ ctrl: controllerName, viewHtml: viewHtml, selfModuleName: selfModuleName, jsName: jsName }, mod.modName);

                    $stateProvider
                        .state(mod.modName, {
                            url: "/" + mod.modName,
                            views: {
                                "adminIndexView": {
                                    controller: controllerName, /// 控制器名称
                                    templateUrl: viewHtml  /// 默认加载模板
                                }
                            },
                            resolve: {
                                loadMyCtrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                    return $ocLazyLoad.load({
                                        name: selfModuleName,    ///　自模块名称
                                        files: [
                                            jsName /// 加载js的文件数组 ，， 可定义加载css
                                        ]
                                    });
                                }]
                            }
                        });
                });

                //post提交乱码
                $locationProvider.html5Mode(false);
                $httpProvider.defaults.transformRequest = function (data) {
                    if (data === undefined) {
                        return data;
                    }
                    return $.param(data);
                };
                $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
            }
        ]);
});
     
     